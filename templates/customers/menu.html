<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Menu</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <style>
      .menu-item {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body>
    <div class="container my-5">
      {% for item in restaurant_name %}
      <h1 class="text-center mb-4">{{ item.restaurant_name }}</h1>
      {% endfor %}
      <div class="row">
        {% for food in food_items %}
        <div class="col-md-6 col-lg-4">
          <div class="menu-item">
            <img
              src="{{ food.item_image }}"
              class="img-fluid mb-3"
              alt="{{ food.item_name }}"
            />
            <h5>{{ food.item_name }}</h5>
            <p>Price: {{ food.item_price }}</p>
            <p>Rating: {{ food.item_rating }}</p>
            <p>Type: {{ food.item_type }}</p>
            <p>Orders: {{ food.order_count }}</p>
            <p>Availability: {{ food.availability }}</p>
            <p>Vegetarian: {{ food.vegetarian }}</p>
            <p>
              Item Quantity: <span id="order-count-{{ food.item_id }}">0</span>
            </p>
            <button
              class="btn btn-success"
              onclick="increaseCount('{{ food.item_id }}')"
            >
              +
            </button>
            <button
              class="btn btn-danger"
              onclick="decreaseCount('{{ food.item_id }}')"
            >
              -
            </button>
          </div>
        </div>
        {% endfor %}
      </div>
      <div class="text-center">
        <button class="btn btn-primary" onclick="finalizeOrder()">
          Finalize Order
        </button>
      </div>

      <!-- Add this section to allow users to select payment method -->
      <div class="payment-method-selection mt-4">
        <h4>Select Payment Method:</h4>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="paymentMethod"
            id="card"
            value="card"
            checked
          />
          <label class="form-check-label" for="card">Card</label>
        </div>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="paymentMethod"
            id="upi"
            value="upi"
          />
          <label class="form-check-label" for="upi">UPI</label>
        </div>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="paymentMethod"
            id="cash"
            value="cash"
          />
          <label class="form-check-label" for="cash">Cash</label>
        </div>
      </div>
    </div>

    <script>
      let itemCounts = {};

      function increaseCount(itemId) {
        if (!itemCounts[itemId]) {
          itemCounts[itemId] = 0;
        }
        itemCounts[itemId]++;
        document.getElementById("order-count-" + itemId).innerText =
          itemCounts[itemId];
      }

      function decreaseCount(itemId) {
        if (!itemCounts[itemId] || itemCounts[itemId] <= 0) {
          itemCounts[itemId] = 0;
        } else {
          itemCounts[itemId]--;
        }
        document.getElementById("order-count-" + itemId).innerText =
          itemCounts[itemId];
      }

      function finalizeOrder() {
        // Get the selected payment method
        const paymentMethodRadios = document.getElementsByName("paymentMethod");
        let paymentMethod;
        for (const radio of paymentMethodRadios) {
          if (radio.checked) {
            paymentMethod = radio.value;
            break;
          }
        }

        // Prepare the ordered_items data
        const orderedItems = [];
        for (const [itemId, itemQuantity] of Object.entries(itemCounts)) {
          if (itemQuantity > 0) {
            orderedItems.push({
              item_id: itemId,
              item_quantity: itemQuantity,
              notes: "", // You can add a field to allow users to enter notes
                            item_price: "{{ food_items|selectattr('item_id', 'equalto', itemId)|map(attribute='item_price')|first }}",
                        });
                    }
                }

                // Redirect to the ordersummary function
                const url = "{{ url_for('ordersummary', rest_id=restaurant_id, payment_method=paymentMethod, payment_status='Successful', ordered_items=orderedItems) }}";
                window.location.href = url;
            }
    </script>
  </body>
</html>