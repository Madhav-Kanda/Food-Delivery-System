<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Menu</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <style>
      .menu-item {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body>
    <div class="container my-5">
      {% for item in restaurant_name %}
      <h1 class="text-center mb-4">{{ item.restaurant_name }}</h1>
      {% endfor %}
      <div class="row">
        {% for food in food_items %}
        <div class="col-md-6 col-lg-4">
          <div class="menu-item">
            <img
              src="{{ food.item_image }}"
              class="img-fluid mb-3"
              alt="{{ food.item_name }}"
            />
            <h5>{{ food.item_name }}</h5>
            <p>Price: {{ food.item_price }}</p>
            <p>Rating: {{ food.item_rating }}</p>
            <p>Type: {{ food.item_type }}</p>
            <p>Orders: {{ food.order_count }}</p>
            <p>Availability: {{ food.availability }}</p>
            <p>Vegetarian: {{ food.vegetarian }}</p>
            <p>
              Item Quantity: <span id="order-count-{{ food.item_id }}">0</span>
            </p>
            <button
              class="btn btn-success"
              onclick="increaseCount('{{ food.item_id }}')"
            >
              +
            </button>
            <button
              class="btn btn-danger"
              onclick="decreaseCount('{{ food.item_id }}')"
            >
              -
            </button>
          </div>
        </div>
        {% endfor %}
      </div>
      <div class="text-center mt-4">
        <div>
          <input
            type="checkbox"
            id="cashCheckbox"
            name="payment_method"
            value="cash"
            onclick="togglePaymentMethod('cash')"
          />
          <label for="cashCheckbox">Cash</label><br />
          <input
            type="checkbox"
            id="cardCheckbox"
            name="payment_method"
            value="card"
            onclick="togglePaymentMethod('card')"
          />
          <label for="cardCheckbox">Card</label><br />
          <input
            type="checkbox"
            id="upiCheckbox"
            name="payment_method"
            value="upi"
            onclick="togglePaymentMethod('upi')"
          />
          <label for="upiCheckbox">UPI</label><br />
        </div>
        <form
          id="orderForm"
          action="/submit_order/{{ restaurantId }}"
          method="post"
        >
          <button type="button" class="btn btn-primary ml-2">
            Finalize Order
          </button>
        </form>
      </div>
    </div>

    <script>
      let itemCounts = {};
      let selectedPaymentMethod = "";
      const restaurantId = "{{ restaurantId }}";

      function increaseCount(itemId) {
        if (!itemCounts[itemId]) {
          itemCounts[itemId] = 0;
        }
        itemCounts[itemId]++;
        document.getElementById("order-count-" + itemId).innerText =
          itemCounts[itemId];
      }

      function decreaseCount(itemId) {
        if (!itemCounts[itemId] || itemCounts[itemId] <= 0) {
          itemCounts[itemId] = 0;
        } else {
          itemCounts[itemId]--;
        }
        document.getElementById("order-count-" + itemId).innerText =
          itemCounts[itemId];
      }

      function togglePaymentMethod(method) {
        selectedPaymentMethod = method;
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach((checkbox) => {
          if (checkbox.id !== method + "Checkbox") {
            checkbox.checked = false;
          }
        });
        console.log("Selected Payment Method:", selectedPaymentMethod);
      }

      function submitOrder() {
        const form = document.getElementById("orderForm");
        const paymentMethodInput = document.createElement("input");
        paymentMethodInput.setAttribute("type", "hidden");
        paymentMethodInput.setAttribute("name", "payment_method");
        paymentMethodInput.setAttribute("value", selectedPaymentMethod);
        form.appendChild(paymentMethodInput);
        form.submit();
      }
    </script>
  </body>
</html>
